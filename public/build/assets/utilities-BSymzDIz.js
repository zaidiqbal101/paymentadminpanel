import{r as n,j as e,n as N,o as f,p as U,q as E}from"./app-0-mZ052T.js";function R(){const[x,u]=n.useState([]),b=[...new Set(x.map(t=>t.category.trim()))],[g,w]=n.useState({}),[s,c]=n.useState(null),[v,j]=n.useState(null),[i,y]=n.useState(null),_=t=>{w(a=>({...a,[t]:!a[t]}))},C=t=>{y(t)},m=i?x.filter(t=>t.category.trim()===i):[];n.useEffect(()=>{async function t(){try{const d=(await N()).data.data||[],o=((await f()).data.data||[]).map(l=>({operator_id:null,id:l.id,operator_name:l.operator_name,category:l.category,type:l.type,commission:l.commission,updated_at:l.updated_at||null})),r=[...d,...o];u(r)}catch(a){console.error("Error fetching data:",a),u([])}}t()},[]);const D=t=>{const a=x.find(d=>d.operator_id?d.operator_id===t.operator_id:d.id===t.id);c(a),j(a)},S=async()=>{try{const t={};if(s.commission!==v.commission&&(t.commission=s.commission),Object.keys(t).length===0){alert("No changes detected!");return}s.operator_id?await U(s.operator_id,t):await E(s.id,t),alert("Commission updated successfully!"),c(null),j(null);const a=await N(),d=await f(),h=a.data.data||[],o=(d.data.data||[]).map(r=>({operator_id:null,id:r.id,operator_name:r.operator_name,category:r.category,type:r.type,commission:r.commission,updated_at:r.updated_at||null}));u([...h,...o])}catch(t){alert("Failed to update commission."),console.error(t)}},k=()=>{if(!m.length){alert("No data to export!");return}const t=["Operator ID","Operator Name","Category","Type","Commission","Last Updated"],a=m.map(r=>{const l=r.updated_at?new Date(r.updated_at).toLocaleString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,year:"numeric",month:"2-digit",day:"2-digit"}):"Not updated yet";return[r.operator_id||"N/A",`"${r.operator_name}"`,`"${r.category}"`,r.type,r.type==="Percentage"?`${r.commission}%`:r.commission,l].join(",")}),d=[t.join(","),...a].join(`
`),h=new Blob([d],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(h),o=document.createElement("a");o.setAttribute("href",p),o.setAttribute("download",`${i}_utility_commission.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(p)};return e.jsxs("div",{className:"max-w-full bg-gray-100 mt-6",children:[e.jsx("div",{className:"bg-gray-700 flex justify-between p-4",children:e.jsx("h3",{className:"text-white font-bold",children:"Utility Commission"})}),e.jsxs("div",{className:"max-w-full bg-gray-100 mt-6",children:[e.jsxs("table",{className:"w-full border-collapse border border-gray-300 mt-4",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.no"}),e.jsx("th",{className:"border p-2",children:"Operator Category"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"})]})}),e.jsx("tbody",{children:b.length>0?b.map((t,a)=>e.jsxs("tr",{className:"border",children:[e.jsx("td",{className:"p-2 border text-center",children:a+1}),e.jsx("td",{className:"p-2 border text-center",children:t}),e.jsx("td",{className:"p-2 border text-center",children:e.jsx("button",{className:`px-4 py-1 rounded-full ${g[t]?"bg-green-500 text-white":"bg-red-500 text-white"}`,onClick:()=>_(t),children:g[t]?"Active":"Inactive"})}),e.jsx("td",{className:"p-2 border text-center",children:e.jsx("button",{className:"bg-blue-500 text-white px-2 py-1 rounded mr-2",onClick:()=>C(t),children:"View Details"})})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center p-4",children:"No data available"})})})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex justify-center transition-all ease-in-out duration-300",children:e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-2xl w-11/12 md:w-2/3 lg:w-2/3 max-h-[80vh] overflow-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold",children:["Details for ",i]}),e.jsx("button",{className:"bg-green-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-green-600 transition-all duration-200",onClick:k,children:"Export to CSV"})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300 mt-4",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2",children:"Operator ID"}),e.jsx("th",{className:"border p-2",children:"Operator Name"}),e.jsx("th",{className:"border p-2",children:"Category"}),e.jsx("th",{className:"border p-2",children:"Type"}),e.jsx("th",{className:"border p-2",children:"Commission"}),e.jsx("th",{className:"border p-2",children:"Last Updated"}),e.jsx("th",{className:"border p-2",children:"Edit Commission"})]})}),e.jsx("tbody",{children:m.length>0?m.map((t,a)=>e.jsxs("tr",{className:"border",children:[e.jsx("td",{className:"p-2 border",children:t.operator_id||"N/A"}),e.jsx("td",{className:"p-2 border",children:t.operator_name}),e.jsx("td",{className:"p-2 border",children:t.category}),e.jsx("td",{className:"p-2 border",children:t.type}),e.jsx("td",{className:"p-2 border",children:t.commission}),e.jsx("td",{className:"border p-2",children:t.updated_at?new Date(t.updated_at).toLocaleString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,year:"numeric",month:"2-digit",day:"2-digit"}):"Not updated yet"}),e.jsx("td",{className:"p-2 border",children:e.jsx("button",{className:"bg-yellow-500 text-white px-2 py-1 rounded",onClick:()=>D(t),children:"Edit Details"})})]},a)):e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center p-4",children:["No data found for ",i]})})})]})}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{className:"bg-red-500 text-white px-5 py-2 rounded-lg shadow-md hover:bg-red-600 transition-all duration-200",onClick:()=>y(null),children:"Close"})})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-2/3 lg:w-2/3",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 text-center mb-4",children:"Edit Commission Details"}),e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2",children:"ID"}),e.jsx("th",{className:"border p-2",children:"Operator Name"}),e.jsx("th",{className:"border p-2",children:"Category"}),e.jsx("th",{className:"border p-2",children:"Type"}),e.jsx("th",{className:"border p-2",children:"Commission"}),e.jsx("th",{className:"border p-2",children:"Last Updated"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:s.operator_id||"N/A"}),e.jsx("td",{className:"border p-2",children:s.operator_name}),e.jsx("td",{className:"border p-2",children:s.category}),e.jsx("td",{className:"border p-2",children:s.type}),e.jsx("td",{className:"border p-2",children:e.jsx("input",{type:"text",className:"w-full border p-2 rounded",value:(s==null?void 0:s.type)==="Percentage"?`${(s==null?void 0:s.commission)??""}%`:(s==null?void 0:s.commission)??"",onChange:t=>{const a=t.target.value.replace("%","");c({...s,commission:a})}})}),e.jsx("td",{className:"border p-2",children:s.updated_at?new Date(s.updated_at).toLocaleString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,year:"numeric",month:"2-digit",day:"2-digit"}):"Not updated yet"})]})})]}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded",onClick:S,children:"Save"}),e.jsx("button",{className:"bg-gray-500 text-white px-4 py-2 rounded ml-2",onClick:()=>c(null),children:"Cancel"})]})]})})]})]})}export{R as default};
