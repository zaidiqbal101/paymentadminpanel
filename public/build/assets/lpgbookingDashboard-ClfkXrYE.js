import{r,E as z,j as e}from"./app-0-mZ052T.js";import{L as f,C as H,a as J,b as K,P as Q,c as V,p as X,d as Z,e as $}from"./index-CLSSDCNk.js";H.register(J,K,Q,V,X,Z,$);const ae=()=>{const[j,F]=r.useState([]),[n,L]=r.useState([]),[D,S]=r.useState("Daily"),[u,w]=r.useState(""),[h,N]=r.useState(""),[C,y]=r.useState(!1);r.useEffect(()=>{A()},[]);const A=async()=>{y(!0);try{const t=await z();console.log("Fetched LPG Data:",t),F(t),b(t,D,u,h)}catch(t){console.error("Failed to fetch LPG data:",t)}finally{y(!1)}},b=(t,a,d,i)=>{let s=[...t];const l=new Date;if(d&&i){const g=new Date(d),p=new Date(i);s=s.filter(o=>{const m=new Date(o.date_added);return m>=g&&m<=p})}else switch(a){case"Daily":s=s.filter(o=>{const m=new Date(o.date_added);return m.getDate()===l.getDate()&&m.getMonth()===l.getMonth()&&m.getFullYear()===l.getFullYear()});break;case"Weekly":const g=new Date(l);g.setDate(l.getDate()-7),s=s.filter(o=>new Date(o.date_added)>=g);break;case"Monthly":const p=new Date(l);p.setMonth(l.getMonth()-1),s=s.filter(o=>new Date(o.date_added)>=p);break}s.length===0&&(s=[...t]),console.log("Filtered Data:",s),L(s)},R=t=>{S(t),w(""),N(""),b(j,t,"","")},_=()=>{u&&h&&b(j,"",u,h)},x=n.length,v=n.reduce((t,a)=>t+parseFloat(a.amount||0),0),T=x?(v/x).toFixed(2):0,k=x>0?(n.filter(t=>t.message.toLowerCase().includes("successful")).length/x*100).toFixed(2):0,E=n.reduce((t,a)=>t+parseFloat(a.tds||0),0),M=n.reduce((t,a)=>t+parseFloat(a.refunded||0),0),c=[...new Set(n.map(t=>new Date(t.date_added).toLocaleDateString()))].sort(),P=c.map(t=>n.filter(a=>new Date(a.date_added).toLocaleDateString()===t).reduce((a,d)=>a+parseFloat(d.amount||0),0)),O=c.map(t=>n.filter(a=>new Date(a.date_added).toLocaleDateString()===t).reduce((a,d)=>a+(d.message.toLowerCase().includes("successful")?1:0),0)),G=c.map(t=>n.filter(a=>new Date(a.date_added).toLocaleDateString()===t).reduce((a,d)=>a+parseFloat(d.refunded||0),0)),U={labels:c,datasets:[{label:"Amount",data:P,borderColor:"green",fill:!1}]},W={labels:c,datasets:[{label:"Success Rate (%)",data:O,borderColor:"green",fill:!1}]},I={labels:c,datasets:[{label:"Refunded Amount",data:G,borderColor:"orange",fill:!1}]},Y=n.reduce((t,a)=>{const d=a.operator_name;return t[d]||(t[d]={amount:0}),t[d].amount+=parseFloat(a.amount||0),t},{}),B=Object.entries(Y).map(([t,{amount:a}])=>({name:t,amount:a})).sort((t,a)=>a.amount-t.amount).slice(0,5),q=()=>{const t=[["Reference ID","Txn ID","Operator Name","Customer Number","Amount","TDS","Refunded","Message","Date Added"],...n.map(s=>[s.reference_id,s.txnid,s.operator_name,s.customer_number,s.amount,s.tds,s.refunded,s.message,new Date(s.date_added).toLocaleDateString()])].map(s=>s.join(",")).join(`
`),a=new Blob([t],{type:"text/csv"}),d=window.URL.createObjectURL(a),i=document.createElement("a");i.href=d,i.download="lpg_transactions.csv",i.click(),window.URL.revokeObjectURL(d)};return e.jsxs("div",{className:"container mx-auto p-6 bg-gray-100 min-h-screen",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"LPG Dashboard"}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{className:"p-2 border rounded",value:D,onChange:t=>R(t.target.value),children:[e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Weekly",children:"Weekly"}),e.jsx("option",{value:"Monthly",children:"Monthly"})]}),e.jsx("input",{type:"date",className:"p-2 border rounded",value:u,onChange:t=>w(t.target.value),placeholder:"dd-mm-yyyy"}),e.jsx("input",{type:"date",className:"p-2 border rounded",value:h,onChange:t=>N(t.target.value),placeholder:"dd-mm-yyyy"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:_,disabled:!u||!h,children:"Apply Date Filter"})]}),e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded",onClick:q,children:"Export Data"})]}),C?e.jsx("div",{className:"text-center",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl",children:x})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl",children:["₹",v.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Avg. Amount"}),e.jsxs("p",{className:"text-2xl",children:["₹",T]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl",children:[k,"%"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total TDS"}),e.jsxs("p",{className:"text-2xl",children:["₹",E.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md text-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Total Refunded"}),e.jsxs("p",{className:"text-2xl",children:["₹",M.toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Amount Trend"}),e.jsx(f,{data:U})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Success Rate by Period"}),e.jsx(f,{data:W})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Refunded Amount Trend"}),e.jsx(f,{data:I})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Top Operators by Amount"}),e.jsx("ul",{children:B.map((t,a)=>e.jsxs("li",{className:"py-2 border-b",children:[t.name,": ₹",t.amount.toFixed(2)]},a))})]})]})]})};export{ae as default};
